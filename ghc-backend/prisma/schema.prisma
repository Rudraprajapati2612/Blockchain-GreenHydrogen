generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String        @id @default(uuid())
  name            String? 
  email           String        @unique
  password        String?       // null For Google/Clerk
  authProvider    AuthProvider  @default(LOCAL)
  status          UserStatus    @default(PENDING)
  role            Role    
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  producerKyc     ProducerKyc?
  certifierKyc    CertifierKyc?
  batches         Batch[]       @relation("ProducerBatches")
  certifications  Batch[]       @relation("CertifierBatch")
  producerLinks   ProducerCertifier[] @relation("ProducerLinks")
  certifierLinks  ProducerCertifier[] @relation("CertifierLinks")
}

model ProducerKyc {
  id         String   @id @default(uuid())
  userId     String   @unique
  user       User     @relation(fields: [userId], references: [id])

  plantName  String
  location   String
  document   String

  approvedBy String?   // SUPER_ADMIN id/email
  approvedAt DateTime?
}

model CertifierKyc {
  id            String   @id @default(uuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])

  fullName      String
  licenseNumber String
  qualification String?
  document      String

  approvedBy    String?
  approvedAt    DateTime?
}

model ProducerCertifier {
  id          String @id @default(uuid())
  producerId  String
  certifierId String

  producer    User   @relation("ProducerLinks", fields: [producerId], references: [id])
  certifier   User   @relation("CertifierLinks", fields: [certifierId], references: [id])

  createdAt   DateTime @default(now())
}

model Batch {
  id          String   @id @default(uuid())
  batchId     String   @unique
  producerId  String
  certifierId String
  quantity    Int 
  metaDataURI String?
  timeStamp   DateTime @default(now())

  producer    User     @relation("ProducerBatches", fields: [producerId], references: [id])
  certifier   User     @relation("CertifierBatch", fields: [certifierId], references: [id])
}

enum AuthProvider {
  LOCAL
  GOOGLE
}

enum Role {
  PRODUCER
  CONSUMER
  SUPER_ADMIN
  CERTIFIER
}

enum UserStatus {
  PENDING
  ACTIVE 
  REJECT
}
